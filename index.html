<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polyglot Grand Archive</title>
    <style>
        :root {
            --primary: #3b82f6; 
            --primary-dark: #1d4ed8;
            --accent: #f59e0b; 
            --danger: #ef4444; 
            
            --bg: #f4f7fa;
            --paper: #ffffff;
            --text-main: #1f2937;
            --text-light: #6b7280;
            --shadow: rgba(0,0,0,0.1);
            --correct: #10b981;
            --wrong: #ef4444;
        }

        [data-theme="dark"] {
            --bg: #0f172a; 
            --paper: #1e293b;
            --text-main: #f3f4f6;
            --text-light: #9ca3af;
            --shadow: rgba(0,0,0,0.5);
        }

        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- SETUP / WELCOME SCREEN --- */
        #setup-screen {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; background: linear-gradient(135deg, var(--paper), var(--bg));
            text-align: center; padding: 2rem;
        }
        .setup-box { background: var(--paper); padding: 3rem; border-radius: 20px; box-shadow: 0 20px 40px var(--shadow); max-width: 500px; width: 100%; }
        .setup-box h1 { margin-top: 0; font-size: 2.5rem; color: var(--text-main); }
        
        .setup-section { margin-bottom: 2rem; text-align: left;}
        .setup-section label { display: block; font-weight: bold; margin-bottom: 1rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 1px;}
        
        .lang-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .choice-btn {
            background: var(--bg); border: 2px solid rgba(0,0,0,0.1); padding: 1rem; border-radius: 12px;
            font-size: 1.1rem; font-weight: bold; color: var(--text-main); cursor: pointer; transition: 0.2s;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .choice-btn:hover { border-color: #3b82f6; transform: translateY(-2px); }
        .choice-btn.selected { background: rgba(59, 130, 246, 0.1); border-color: #3b82f6; color: #3b82f6; }
        
        .start-btn { width: 100%; background: #10b981; color: white; border: none; padding: 1.2rem; border-radius: 12px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .start-btn:hover { background: #059669; }

        /* --- MAIN APP VIEWS --- */
        #app-screen { display: none; flex-direction: column; flex: 1; }

        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white; padding: 2rem 1rem 5rem; text-align: center; position: relative;
            box-shadow: 0 4px 20px var(--shadow); border-bottom: 5px solid var(--accent);
        }

        .top-nav { position: absolute; top: 20px; right: 20px; left: 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        
        .settings-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; backdrop-filter: blur(5px); }
        .settings-btn:hover { background: rgba(255,255,255,0.3); }

        .theme-switch { display: inline-block; height: 30px; position: relative; width: 54px; }
        .theme-switch input { display: none; }
        .slider { background-color: rgba(255,255,255,0.3); bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 34px; }
        .slider:before { background-color: white; bottom: 3px; content: ""; height: 24px; left: 3px; position: absolute; transition: .4s; width: 24px; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(24px); }

        .symbol-wrapper { font-size: 4rem; margin: 0 auto 0.5rem; text-shadow: 0 4px 10px rgba(0,0,0,0.3); line-height: 1; }
        header h1 { margin: 0; font-size: 2.5rem; font-weight: 800; letter-spacing: -1px; }
        header p { font-size: 1.1rem; opacity: 0.9; margin-top: 0.5rem; font-style: italic; }

        .controls-bar { display: flex; justify-content: center; gap: 1.5rem; margin-top: 1.5rem; flex-wrap: wrap;}
        .control-item { background: rgba(255,255,255,0.15); backdrop-filter: blur(5px); padding: 0.75rem 1.2rem; border-radius: 12px; display: flex; align-items: center; gap: 8px; font-weight: 600; border: 1px solid rgba(255,255,255,0.3); cursor: pointer; transition: 0.2s; }
        .control-item:hover { background: rgba(255,255,255,0.25); }

        /* --- CONTAINER --- */
        .container { max-width: 1100px; margin: -40px auto 0; padding: 0 1.5rem 4rem; display: grid; grid-template-columns: repeat(12, 1fr); gap: 2rem; z-index: 5; position: relative; }

        .card { background: var(--paper); border-radius: 16px; padding: 2rem; box-shadow: 0 10px 30px var(--shadow); transition: transform 0.3s ease; display: flex; flex-direction: column; border-top: 5px solid transparent; }
        .card:hover { transform: translateY(-5px); }

        .label { text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1.5px; font-weight: 800; color: var(--text-light); margin-bottom: 0.8rem; display: flex; align-items: center; gap: 8px; }
        .label::before { content: ''; display: block; width: 8px; height: 8px; border-radius: 50%; background: currentColor; }

        .target-text { font-size: 2.2rem; font-weight: 800; line-height: 1.2; margin: 0 0 0.5rem 0; color: var(--primary); }
        .pronunciation { font-family: 'Consolas', monospace; color: var(--accent); font-size: 0.95rem; margin-bottom: 1rem; background: rgba(0,0,0,0.03); padding: 3px 8px; border-radius: 4px; display: inline-block; }
        .meaning { font-size: 1.15rem; line-height: 1.6; margin-top: auto; border-left: 4px solid var(--accent); padding-left: 1rem; color: var(--text-main); }

        .card-special { grid-column: span 12; border-top-color: var(--accent); background: linear-gradient(to right, var(--paper), rgba(0,0,0,0.02));}
        .card-special .label { color: var(--accent); }
        .card-word { grid-column: span 6; border-top-color: var(--primary); }
        .card-word .label { color: var(--primary); }
        .card-idiom { grid-column: span 6; border-top-color: #8b5cf6; }
        .card-idiom .label { color: #8b5cf6; }
        .card-proverb { grid-column: span 12; border-top-color: var(--danger); }
        .card-proverb .label { color: var(--danger); }

        /* --- QUIZ --- */
        .quiz-container { grid-column: span 12; background: var(--paper); padding: 2.5rem; border-radius: 16px; text-align: center; box-shadow: 0 4px 10px var(--shadow); margin-top: 1rem; }
        .score-board { display: flex; justify-content: center; gap: 2rem; margin-bottom: 1.5rem; font-weight: bold; font-size: 1.2rem; }
        .score-correct { color: var(--correct); }
        .score-wrong { color: var(--wrong); }
        
        .quiz-question { font-size: 1.2rem; margin-bottom: 0.5rem; color: var(--text-light); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;}
        .quiz-word-box { margin: 1.5rem 0; }
        .quiz-word { color: var(--primary); font-weight: 800; font-size: 2.5rem; line-height: 1.2; }
        .quiz-pron { font-family: 'Consolas', monospace; color: var(--accent); font-size: 1.2rem; background: rgba(0,0,0,0.03); padding: 4px 12px; border-radius: 6px; display: inline-block; margin-top: 0.5rem; }

        .quiz-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1rem; margin-top: 1.5rem; }
        .quiz-btn { background: var(--bg); border: 2px solid rgba(0,0,0,0.1); padding: 1.2rem; border-radius: 12px; font-size: 1.05rem; font-weight: 600; color: var(--text-main); cursor: pointer; transition: all 0.2s; }
        .quiz-btn:hover:not([disabled]) { border-color: var(--primary); background: rgba(0,0,0,0.02);}
        .quiz-btn.correct { background: rgba(16, 185, 129, 0.1); border-color: var(--correct); color: var(--correct); }
        .quiz-btn.wrong { background: rgba(239, 68, 68, 0.1); border-color: var(--wrong); color: var(--wrong); opacity: 0.6; }

        .next-btn { margin-top: 2rem; background: var(--primary); color: white; border: none; padding: 1rem 2rem; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; display: none; transition: background 0.2s; }
        .next-btn:hover { background: var(--primary-dark); }

        /* --- CALENDAR MODAL --- */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(3px); }
        .modal { background: var(--paper); padding: 2rem; border-radius: 16px; width: 90%; max-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); text-align: center; }
        .modal h3 { margin-top: 0; color: var(--text-main); }
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; font-weight: bold;}
        .cal-nav { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--primary); }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .cal-day-name { font-size: 0.8rem; color: var(--text-light); font-weight: bold; padding-bottom: 5px; }
        .cal-cell { padding: 10px 0; border-radius: 8px; font-size: 0.9rem; cursor: pointer; color: var(--text-main); background: var(--bg); transition: 0.2s; }
        .cal-cell:hover:not(.empty) { background: rgba(0,0,0,0.1); }
        .cal-cell.empty { background: transparent; cursor: default; }
        .cal-cell.active-day { background: var(--correct); color: white; font-weight: bold; }
        .cal-cell.selected-day { border: 2px solid var(--primary); transform: scale(1.1); }
        .close-modal { margin-top: 1.5rem; background: var(--bg); border: none; padding: 0.5rem 1.5rem; border-radius: 8px; cursor: pointer; color: var(--text-main); font-weight: bold; }

        @media (max-width: 768px) {
            .card-word, .card-idiom { grid-column: span 12; }
            header h1 { font-size: 2rem; }
            .lang-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div id="setup-screen">
    <div class="setup-box">
        <h1 id="ui-setup-title">Polyglot Archive</h1>
        
        <div class="setup-section">
            <label id="ui-setup-target">I want to learn:</label>
            <div class="lang-grid" id="target-lang-grid"></div>
        </div>

        <div class="setup-section">
            <label id="ui-setup-interface">Interface Language:</label>
            <div class="lang-grid">
                <button class="choice-btn" id="btn-int-en" onclick="selectInterface('en')">üá¨üáß English</button>
                <button class="choice-btn" id="btn-int-tr" onclick="selectInterface('tr')">üáπüá∑ T√ºrk√ße</button>
            </div>
        </div>

        <button class="start-btn" id="ui-setup-start" onclick="startApp()">Start Learning</button>
    </div>
</div>

<div id="app-screen">
    <header>
        <div class="top-nav">
            <button class="settings-btn" id="ui-nav-settings" onclick="openSettings()">‚öô Settings</button>
            <label class="theme-switch" title="Toggle Dark Mode">
                <input type="checkbox" id="theme-toggle" />
                <div class="slider"></div>
            </label>
        </div>

        <div class="symbol-wrapper" id="header-symbol">üåç</div>
        <h1 id="header-title">Archive</h1>
        <p id="ui-header-sub">Daily Words, Idioms & Proverbs</p>

        <div class="controls-bar">
            <div class="control-item" onclick="openCalendar()">
                <span>üìÖ</span> <span id="current-date-display">Today</span>
            </div>
            <div class="control-item">
                <span>üî•</span> <span id="streak-count">0</span> <span id="ui-header-streak">Day Streak</span>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="card card-special">
            <div class="label" id="ui-lbl-special">Cultural Feature</div>
            <h2 class="target-text" id="special-t">...</h2>
            <div class="pronunciation" id="special-p">...</div>
            <div class="meaning" id="special-m">...</div>
        </div>

        <div class="card card-word">
            <div class="label" id="ui-lbl-word">Word of the Day</div>
            <h2 class="target-text" id="word-t">...</h2>
            <div class="pronunciation" id="word-p">...</div>
            <div class="meaning" id="word-m">...</div>
        </div>

        <div class="card card-idiom">
            <div class="label" id="ui-lbl-idiom">Idiom of the Day</div>
            <h2 class="target-text" id="idiom-t">...</h2>
            <div class="pronunciation" id="idiom-p">...</div>
            <div class="meaning" id="idiom-m">...</div>
        </div>

        <div class="card card-proverb">
            <div class="label" id="ui-lbl-proverb">Proverb of the Day</div>
            <h2 class="target-text" id="proverb-t">...</h2>
            <div class="pronunciation" id="proverb-p">...</div>
            <div class="meaning" id="proverb-m">...</div>
        </div>

        <div class="quiz-container">
            <div class="score-board">
                <div class="score-correct">‚úî <span id="score-correct">0</span></div>
                <div class="score-wrong">‚úñ <span id="score-wrong">0</span></div>
            </div>
            
            <div class="label" style="justify-content: center;" id="ui-lbl-challenge">Knowledge Check</div>
            <div class="quiz-question" id="ui-quiz-q">What does this word mean?</div>
            
            <div class="quiz-word-box">
                <div class="quiz-word" id="quiz-question"></div>
                <div class="quiz-pron" id="quiz-pronunciation"></div>
            </div>
            
            <div class="quiz-grid" id="quiz-options"></div>
            <div id="quiz-feedback" style="margin-top:1.5rem; font-weight:800; min-height:1.5em; color:var(--text-main);"></div>
            
            <button class="next-btn" id="next-btn" onclick="setupQuiz()"></button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="calendar-modal">
    <div class="modal">
        <h3 id="ui-cal-title">Activity Calendar</h3>
        <div class="cal-header">
            <button class="cal-nav" onclick="changeCalMonth(-1)">‚ùÆ</button>
            <span id="cal-month-year">...</span>
            <button class="cal-nav" onclick="changeCalMonth(1)">‚ùØ</button>
        </div>
        <div class="cal-grid" id="cal-grid"></div>
        <div style="font-size:0.75rem; margin-top:10px; color:var(--text-light);">
            <span style="display:inline-block; width:10px; height:10px; background:var(--correct); border-radius:2px;"></span> = <span id="ui-cal-practiced">Practiced</span>
        </div>
        <button class="close-modal" onclick="closeCalendar()" id="ui-cal-close">Close</button>
    </div>
</div>

<script>
    /* =========================================================================
       1. CONFIGURATION
    ========================================================================= */
    const CONFIG = {
        fr: { id: 'fr', name: { en: "French", tr: "Fransƒ±zca" }, colors: { primary: "#0055A4", dark: "#003d7a", accent: "#EF4135", danger: "#27ae60" }, symbol: "‚öúÔ∏è" },
        mn: { id: 'mn', name: { en: "Mongolian", tr: "Moƒüolca" }, colors: { primary: "#0066B3", dark: "#004d88", accent: "#FFD900", danger: "#DA2032" }, symbol: "üõï" },
        tr: { id: 'tr', name: { en: "Turkish", tr: "T√ºrk√ße" }, colors: { primary: "#c0392b", dark: "#922b21", accent: "#1abc9c", danger: "#2980b9" }, symbol: "üßø" }
    };

    const UI_I18N = {
        en: {
            setupTitle: "Welcome to Polyglot Archive", setupTarget: "I want to learn:", setupInt: "Interface Language:", setupStart: "Start Learning",
            navSettings: "‚öô Settings", headerSub: "Daily Words, Idioms & Proverbs", headerStreak: "Day Streak",
            lblSpecial: "Cultural Feature", lblWord: "Word of the Day", lblIdiom: "Idiom of the Day", lblProverb: "Proverb of the Day", lblChallenge: "Knowledge Check",
            quizQ: "What does this mean?", nextBtn: "Next Question ‚ûî",
            correct: "Correct! üéâ", wrong: "Incorrect. The answer is:",
            today: "Today", calTitle: "Activity Calendar", calPracticed: "Practiced", calClose: "Close",
            days: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'], months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
        },
        tr: {
            setupTitle: "Poliglot Hazinesine Ho≈ü Geldiniz", setupTarget: "√ñƒürenmek ƒ∞stediƒüim Dil:", setupInt: "Aray√ºz Dili:", setupStart: "√ñƒürenmeye Ba≈üla",
            navSettings: "‚öô Ayarlar", headerSub: "G√ºnl√ºk Kelimeler, Deyimler ve Atas√∂zleri", headerStreak: "G√ºn Serisi",
            lblSpecial: "Ayƒ±n K√ºlt√ºrel Kelimesi", lblWord: "G√ºn√ºn Kelimesi", lblIdiom: "G√ºn√ºn Deyimi", lblProverb: "G√ºn√ºn Atas√∂z√º", lblChallenge: "Kendini Dene",
            quizQ: "Bunun anlamƒ± nedir?", nextBtn: "Sƒ±radaki Soru ‚ûî",
            correct: "Doƒüru! üéâ", wrong: "Yanlƒ±≈ü. Doƒüru cevap:",
            today: "Bug√ºn", calTitle: "Aktivite Takvimi", calPracticed: "√áalƒ±≈üƒ±ldƒ±", calClose: "Kapat",
            days: ['Pz', 'Pt', 'Sa', '√áa', 'Pe', 'Cu', 'Ct'], months: ["Ocak", "≈ûubat", "Mart", "Nisan", "Mayƒ±s", "Haziran", "Temmuz", "Aƒüustos", "Eyl√ºl", "Ekim", "Kasƒ±m", "Aralƒ±k"]
        }
    };

    /* =========================================================================
       2. DATABASE (With Literal Translations / Birebir √áeviriler)
    ========================================================================= */
    const DB = {
        fr: {
            words: [
                {t:"Maison", p:"Me-zon", en:"House", tr:"Ev"}, {t:"Chat", p:"≈ûa", en:"Cat", tr:"Kedi"}, {t:"Chien", p:"≈ûiyen", en:"Dog", tr:"K√∂pek"},
                {t:"Voiture", p:"Vua-t√ºr", en:"Car", tr:"Araba"}, {t:"Livre", p:"Liv-r", en:"Book", tr:"Kitap"}, {t:"Ami", p:"A-mi", en:"Friend", tr:"Arkada≈ü"},
                {t:"Soleil", p:"So-ley", en:"Sun", tr:"G√ºne≈ü"}, {t:"Eau", p:"O", en:"Water", tr:"Su"}, {t:"Temps", p:"Tan", en:"Time/Weather", tr:"Zaman/Hava"},
                {t:"Heureux", p:"√ñ-r√∂", en:"Happy", tr:"Mutlu"}, {t:"Fleur", p:"Fl√∂r", en:"Flower", tr:"√ái√ßek"}, {t:"Arbre", p:"Ar-br", en:"Tree", tr:"Aƒüa√ß"},
                {t:"Pain", p:"Pen", en:"Bread", tr:"Ekmek"}, {t:"Vin", p:"Ven", en:"Wine", tr:"≈ûarap"}, {t:"Fromage", p:"Fro-maj", en:"Cheese", tr:"Peynir"},
                {t:"Rue", p:"R√º", en:"Street", tr:"Sokak"}, {t:"Ville", p:"Vil", en:"City", tr:"≈ûehir"}, {t:"Pays", p:"Pe-yi", en:"Country", tr:"√úlke"},
                {t:"R√™ve", p:"Rev", en:"Dream", tr:"R√ºya"}, {t:"Matin", p:"Ma-ten", en:"Morning", tr:"Sabah"}, {t:"Nuit", p:"N√ºi", en:"Night", tr:"Gece"},
                {t:"Libert√©", p:"Li-ber-te", en:"Freedom", tr:"√ñzg√ºrl√ºk"}, {t:"V√©rit√©", p:"Ve-ri-te", en:"Truth", tr:"Ger√ßek"}, {t:"C≈ìur", p:"K√∂r", en:"Heart", tr:"Kalp"},
                {t:"Sourire", p:"Su-rir", en:"Smile", tr:"G√ºl√ºmseme"}, {t:"Manger", p:"Man-je", en:"To eat", tr:"Yemek yemek"}, {t:"Boire", p:"Buar", en:"To drink", tr:"ƒ∞√ßmek"},
                {t:"Dormir", p:"Dor-mir", en:"To sleep", tr:"Uyumak"}, {t:"Parler", p:"Par-le", en:"To speak", tr:"Konu≈ümak"}, {t:"Trouver", p:"Tru-ve", en:"To find", tr:"Bulmak"},
                {t:"Nouveau", p:"Nu-vo", en:"New", tr:"Yeni"}, {t:"Vieux", p:"Viy√∂", en:"Old", tr:"Eski"}, {t:"Beau", p:"Bo", en:"Beautiful", tr:"G√ºzel"},
                {t:"Rapide", p:"Ra-pid", en:"Fast", tr:"Hƒ±zlƒ±"}, {t:"Facile", p:"Fa-sil", en:"Easy", tr:"Kolay"}, {t:"Difficile", p:"Di-fi-sil", en:"Difficult", tr:"Zor"}
            ],
            idioms: [
                {t:"Poser un lapin", p:"Po-ze an la-pen", en:"To stand someone up. (Lit: To put a rabbit)", tr:"Birini ekmek (randevuya gitmemek). (Kelime: Tav≈üan koymak)"},
                {t:"Avoir le cafard", p:"A-vuar l√∂ ka-far", en:"To feel depressed. (Lit: To have the cockroach)", tr:"Depresif hissetmek. (Kelime: Hamamb√∂ceƒüine sahip olmak)"},
                {t:"Tomber dans les pommes", p:"Tom-be dan le pom", en:"To faint. (Lit: To fall in the apples)", tr:"Bayƒ±lmak. (Kelime: Elmalara d√º≈ümek)"},
                {t:"Avoir la p√™che", p:"A-vuar la pe≈ü", en:"To be full of energy. (Lit: To have the peach)", tr:"Enerjik olmak. (Kelime: ≈ûeftaliye sahip olmak)"},
                {t:"Faire la grasse matin√©e", p:"Fer la gras ma-ti-ne", en:"To sleep in. (Lit: To make the fat morning)", tr:"√ñƒülene kadar uyumak. (Kelime: Yaƒülƒ± sabah yapmak)"}
            ],
            proverbs: [
                {t:"Qui vivra verra", p:"Ki viv-ra ve-ra", en:"Time will tell. (Lit: Who lives will see)", tr:"Zaman g√∂sterir. (Kelime: Ya≈üayan g√∂recek)"},
                {t:"Mieux vaut tard que jamais", p:"Miy√∂ vo tar k√∂ ja-me", en:"Better late than never.", tr:"Ge√ß olsun g√º√ß olmasƒ±n."},
                {t:"L'habit ne fait pas le moine", p:"La-bi n√∂ fe pa l√∂ muan", en:"Don't judge a book by its cover. (Lit: The habit doesn't make the monk)", tr:"G√∂r√ºn√º≈üe aldanma. (Kelime: Kƒ±yafet ke≈üi≈ü yapmaz)"},
                {t:"Vouloir, c'est pouvoir", p:"Vu-luar, se pu-vuar", en:"Where there is a will, there is a way. (Lit: To want is to be able to)", tr:"ƒ∞steyen ba≈üarƒ±r. (Kelime: ƒ∞stemek yapabilmektir)"}
            ],
            specials: [
                {t:"D√©j√† vu", p:"De-ja v√º", en:"Feeling of having already experienced something.", tr:"Daha √∂nce ya≈üanmƒ±≈ülƒ±k hissi."},
                {t:"Fl√¢neur", p:"Fla-n√∂r", en:"A person wandering the city streets.", tr:"≈ûehirde aylak aylak dola≈üan ki≈üi."},
                {t:"Savoir-vivre", p:"Sa-vuar viv-r", en:"Knowledge of polite society.", tr:"G√∂rg√º kurallarƒ±, ya≈üamayƒ± bilmek."}
            ]
        },
        mn: {
            words: [
                {t:"–ì—ç—Ä", p:"Ger", en:"Home/Yurt", tr:"Ev/√áadƒ±r"}, {t:"–£—Å", p:"Us", en:"Water", tr:"Su"}, {t:"–ú–æ—Ä—å", p:"Mori", en:"Horse", tr:"At"},
                {t:"–¢—ç–Ω–≥—ç—Ä", p:"Tenger", en:"Sky/Heaven", tr:"G√∂ky√ºz√º/Tengri"}, {t:"–ù–∞–π–∑", p:"Naiz", en:"Friend", tr:"Arkada≈ü"}, {t:"–°–∞–ª—Ö–∏", p:"Salkhi", en:"Wind", tr:"R√ºzgar"},
                {t:"–ì–∞–ª", p:"Gal", en:"Fire", tr:"Ate≈ü"}, {t:"”®–¥”©—Ä", p:"√ñd√∂r", en:"Day", tr:"G√ºn"}, {t:"–ó–∞–º", p:"Zam", en:"Road", tr:"Yol"},
                {t:"–°–∞–π–Ω", p:"Sain", en:"Good", tr:"ƒ∞yi"}, {t:"–°“Ø“Ø", p:"S√º√º", en:"Milk", tr:"S√ºt"}, {t:"–¢–∞–ª—Ö", p:"Talkh", en:"Bread", tr:"Ekmek"},
                {t:"–ú–∞—Ö", p:"Makh", en:"Meat", tr:"Et"}, {t:"–ù–æ—Ö–æ–π", p:"Nokhoi", en:"Dog", tr:"K√∂pek"}, {t:"–¢—ç–º—ç—ç", p:"Temee", en:"Camel", tr:"Deve"},
                {t:"–•“Ø–Ω", p:"Kh√ºn", en:"Person", tr:"ƒ∞nsan"}, {t:"–≠—ç–∂", p:"Eej", en:"Mother", tr:"Anne"}, {t:"–ê–∞–≤", p:"Aav", en:"Father", tr:"Baba"},
                {t:"–ù–∞—Ä", p:"Nar", en:"Sun", tr:"G√ºne≈ü"}, {t:"–°–∞—Ä", p:"Sar", en:"Moon", tr:"Ay"}, {t:"–£—É–ª", p:"Uul", en:"Mountain", tr:"Daƒü"},
                {t:"–¶–∞—Å", p:"Tsas", en:"Snow", tr:"Kar"}, {t:"–ë–æ—Ä–æ–æ", p:"Boroo", en:"Rain", tr:"Yaƒümur"}, {t:"–®”©–Ω”©", p:"Sh√∂n√∂", en:"Night", tr:"Gece"},
                {t:"–¶–∞–≥", p:"Tsag", en:"Time", tr:"Zaman"}, {t:"–¢–æ–º", p:"Tom", en:"Big", tr:"B√ºy√ºk"}, {t:"–ñ–∏–∂–∏–≥", p:"Jijig", en:"Small", tr:"K√º√ß√ºk"},
                {t:"–Ø–≤–∞—Ö", p:"Yavakh", en:"To go", tr:"Gitmek"}, {t:"–ò—Ä—ç—Ö", p:"Irekh", en:"To come", tr:"Gelmek"}, {t:"–ò–¥—ç—Ö", p:"Idekh", en:"To eat", tr:"Yemek yemek"},
                {t:"–£–Ω—Ç–∞—Ö", p:"Untakh", en:"To sleep", tr:"Uyumak"}, {t:"–°—É—Ä–≥—É—É–ª—å", p:"Surguuli", en:"School", tr:"Okul"}, {t:"–ù–æ–º", p:"Nom", en:"Book", tr:"Kitap"},
                {t:"–ú”©–Ω–≥”©", p:"M√∂ng√∂", en:"Money", tr:"Para"}, {t:"–•–∞–π—Ä", p:"Khair", en:"Love", tr:"A≈ük"}
            ],
            idioms: [
                {t:"–ß–∏—Ö—ç–Ω –¥—ç—ç—Ä —Ü—ç—Ü—ç–≥ —É—Ä–≥–∞—Ö", p:"Chikhen deer tsetseg urgakh", en:"To be flattered. (Lit: Flowers growing on ears)", tr:"√áok gururlanmak. (Kelime: Kulaklarda √ßi√ßek a√ßmasƒ±)"},
                {t:"–ú–æ—Ä–∏–Ω–æ–æ—Å —É–Ω–∞—Ö", p:"Morinoos unakh", en:"To fail at a task. (Lit: To fall from a horse)", tr:"Bir i≈üte ba≈üarƒ±sƒ±z olmak. (Kelime: Attan d√º≈ümek)"},
                {t:"–ì–∞—Ä —Ü–∞–π–ª–≥–∞—Ö", p:"Gar tsailgakh", en:"To give a tip/gift. (Lit: To make hands white)", tr:"Hediye/bah≈üi≈ü vermek. (Kelime: Elleri beyazlatmak)"},
                {t:"–°–∞–ª—Ö–∏ –æ—Ä—É—É–ª–∞—Ö", p:"Salkhi oruulakh", en:"To get fresh air. (Lit: To let wind enter)", tr:"Hava almak. (Kelime: R√ºzgar sokmak)"}
            ],
            proverbs: [
                {t:"–•–æ–æ—Å–æ–Ω —Å–∞–≤ –¥—É—É –∏—Ö—Ç—ç–π", p:"Khooson sav duu ikhtei", en:"Empty vessels make the most noise.", tr:"Bo≈ü teneke √ßok ses √ßƒ±karƒ±r."},
                {t:"–û–ª–æ–Ω —Ö–∞–≤–∞—Ä –Ω—ç–≥—ç–Ω–¥—ç—ç", p:"Olon khavar negendee", en:"You can't get away with bad deeds forever. (Lit: Many springs end in one)", tr:"Su testisi su yolunda kƒ±rƒ±lƒ±r. (Kelime: Bir√ßok ilkbahar birinde biter)"},
                {t:"–î—É—Å–∞–ª –¥—É—Å–ª–∞–∞—Ä –¥–∞–ª–∞–π –±–æ–ª–Ω–æ", p:"Dusal duslaar dalai bolno", en:"Every little bit helps. (Lit: Drop by drop becomes an ocean)", tr:"Damlaya damlaya g√∂l olur."}
            ],
            specials: [
                {t:"–ê–π—Ä–∞–≥", p:"Airag", en:"Fermented mare's milk beverage.", tr:"Kƒ±mƒ±z (Fermente kƒ±srak s√ºt√º)."},
                {t:"–ù–∞–∞–¥–∞–º", p:"Naadam", en:"Traditional summer festival.", tr:"Geleneksel yaz festivali."},
                {t:"–ú–æ—Ä–∏–Ω —Ö—É—É—Ä", p:"Morin Khuur", en:"The 'Horsehead fiddle'.", tr:"Geleneksel at kafalƒ± yaylƒ± √ßalgƒ±."}
            ]
        },
        tr: {
            words: [
                {t:"Te≈üekk√ºrler", p:"Teh-shek-kur-ler", en:"Thank you", tr:"Te≈üekk√ºrler"}, {t:"Arkada≈ü", p:"Ar-ka-dash", en:"Friend", tr:"Arkada≈ü"},
                {t:"Kahvaltƒ±", p:"Kah-val-tuh", en:"Breakfast", tr:"Kahvaltƒ±"}, {t:"Deniz", p:"Deh-niz", en:"Sea", tr:"Deniz"},
                {t:"Bilgisayar", p:"Bil-gi-sa-yar", en:"Computer", tr:"Bilgisayar"}, {t:"Umut", p:"Oo-moot", en:"Hope", tr:"Umut"},
                {t:"Zaman", p:"Za-man", en:"Time", tr:"Zaman"}, {t:"G√∂ky√ºz√º", p:"Gok-yoo-zoo", en:"Sky", tr:"G√∂ky√ºz√º"},
                {t:"A≈ük", p:"Ash-k", en:"Love", tr:"A≈ük"}, {t:"Yolculuk", p:"Yol-ju-look", en:"Journey", tr:"Yolculuk"},
                {t:"Kitap", p:"Ki-tap", en:"Book", tr:"Kitap"}, {t:"Masa", p:"Ma-sa", en:"Table", tr:"Masa"}, {t:"Kapƒ±", p:"Ka-pi", en:"Door", tr:"Kapƒ±"},
                {t:"Su", p:"Soo", en:"Water", tr:"Su"}, {t:"Ekmek", p:"Ek-mek", en:"Bread", tr:"Ekmek"}, {t:"G√ºne≈ü", p:"Goo-nesh", en:"Sun", tr:"G√ºne≈ü"},
                {t:"Ay", p:"Ai", en:"Moon", tr:"Ay"}, {t:"Yƒ±ldƒ±z", p:"Yil-diz", en:"Star", tr:"Yƒ±ldƒ±z"}, {t:"Bulut", p:"Bu-loot", en:"Cloud", tr:"Bulut"},
                {t:"R√ºya", p:"Roo-ya", en:"Dream", tr:"R√ºya"}, {t:"Ger√ßek", p:"Ger-chek", en:"Truth/Real", tr:"Ger√ßek"}, {t:"Yalan", p:"Ya-lan", en:"Lie", tr:"Yalan"},
                {t:"Kedi", p:"Ke-di", en:"Cat", tr:"Kedi"}, {t:"K√∂pek", p:"Ko-pek", en:"Dog", tr:"K√∂pek"}, {t:"Aƒüa√ß", p:"A-ach", en:"Tree", tr:"Aƒüa√ß"},
                {t:"√ái√ßek", p:"Chi-chek", en:"Flower", tr:"√ái√ßek"}, {t:"Ev", p:"Ev", en:"House", tr:"Ev"}, {t:"≈ûehir", p:"She-hir", en:"City", tr:"≈ûehir"},
                {t:"G√ºzel", p:"Goo-zel", en:"Beautiful", tr:"G√ºzel"}, {t:"Zor", p:"Zor", en:"Difficult", tr:"Zor"}, {t:"Kolay", p:"Ko-lay", en:"Easy", tr:"Kolay"}
            ],
            idioms: [
                {t:"G√∂ze girmek", p:"Go-ze gir-mek", en:"To gain favor. (Lit: To enter the eye)", tr:"G√∂ze girmek."},
                {t:"Etekleri zil √ßalmak", p:"E-tek-le-ri zil chal-mak", en:"To be extremely excited. (Lit: Skirt bells ringing)", tr:"√áok heyecanlanmak, sevinmek. (Kelime: Etekleri zil √ßalmak)"},
                {t:"Pireyi deve yapmak", p:"Pi-re-yi de-ve yap-mak", en:"To exaggerate. (Lit: To make a camel out of a flea)", tr:"Bir ≈üeyi √ßok abartmak. (Kelime: Pireyi deve yapmak)"},
                {t:"√áam devirmek", p:"Cham de-vir-mek", en:"To make a blunder. (Lit: To knock down a pine tree)", tr:"Pot kƒ±rmak, istenmeyen laf etmek. (Kelime: √áam devirmek)"}
            ],
            proverbs: [
                {t:"Damlaya damlaya g√∂l olur", p:"Dam-la-ya dam-la-ya gol o-lur", en:"Little things add up. (Lit: Drop by drop becomes a lake)", tr:"K√º√ß√ºk birikimler b√ºy√ºr. (Kelime: Damlaya damlaya g√∂l olur)"},
                {t:"Acele i≈üe ≈üeytan karƒ±≈üƒ±r", p:"A-je-le i-she shey-tan ka-ri-shir", en:"Haste makes waste. (Lit: The devil mixes with hurried work)", tr:"Hƒ±zlƒ± ve dikkatsiz yapƒ±lan i≈ü bozuk olur."},
                {t:"G√ºl√º sever dikenine katlanƒ±r", p:"Goo-loo se-ver di-ke-ni-ne kat-la-nir", en:"Accept the bad with the good. (Lit: The rose lover bears its thorns)", tr:"ƒ∞yi bir ≈üey i√ßin zorluklara katlanmak gerekir."}
            ],
            specials: [
                {t:"Yakamoz", p:"Ya-ka-moz", en:"Phosphorescence of the moon on water.", tr:"Ayƒ±n veya ƒ±≈üƒ±ƒüƒ±n su y√ºzeyindeki parƒ±ltƒ±sƒ±."},
                {t:"H√ºz√ºn", p:"Hoo-zoon", en:"Melancholic nostalgia.", tr:"Derin, manevi bir √ºz√ºnt√º veya melankoli."},
                {t:"Kolay gelsin", p:"Ko-lay gel-sin", en:"May it come easy (encouragement).", tr:"√áalƒ±≈üan birine s√∂ylenen iyi dilek s√∂z√º."}
            ]
        }
    };

    /* =========================================================================
       3. STATE MANAGEMENT
    ========================================================================= */
    let state = {
        target: null, // 'fr', 'mn', 'tr'
        interface: 'en', // 'en', 'tr'
        theme: 'light',
        date: new Date(),
        calDate: new Date(),
        lastQuizWord: null // Memory variable to prevent repetition
    };

    function initSettings() {
        state.target = localStorage.getItem('poly_target');
        state.interface = localStorage.getItem('poly_interface') || 'en';
        state.theme = localStorage.getItem('poly_theme') || 'light';

        const themeToggle = document.getElementById('theme-toggle');
        if (state.theme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeToggle.checked = true;
        }
        themeToggle.addEventListener('change', (e) => {
            state.theme = e.target.checked ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', state.theme);
            localStorage.setItem('poly_theme', state.theme);
        });

        buildTargetGrid();
        updateInterfaceButtons();
        translateSetup();

        if (state.target && CONFIG[state.target]) {
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'flex';
            loadApp();
        }
    }

    /* --- SETUP FUNCTIONS --- */
    function buildTargetGrid() {
        const grid = document.getElementById('target-lang-grid');
        grid.innerHTML = '';
        for (const [key, lang] of Object.entries(CONFIG)) {
            const btn = document.createElement('button');
            btn.className = `choice-btn ${state.target === key ? 'selected' : ''}`;
            btn.innerHTML = `<span style="font-size:1.5rem">${lang.symbol}</span> ${lang.name[state.interface]}`;
            btn.onclick = () => {
                state.target = key;
                buildTargetGrid(); 
            };
            grid.appendChild(btn);
        }
    }

    function selectInterface(lang) {
        state.interface = lang;
        updateInterfaceButtons();
        translateSetup();
        buildTargetGrid(); 
    }

    function updateInterfaceButtons() {
        document.getElementById('btn-int-en').classList.toggle('selected', state.interface === 'en');
        document.getElementById('btn-int-tr').classList.toggle('selected', state.interface === 'tr');
    }

    function translateSetup() {
        const dict = UI_I18N[state.interface];
        document.getElementById('ui-setup-title').textContent = dict.setupTitle;
        document.getElementById('ui-setup-target').textContent = dict.setupTarget;
        document.getElementById('ui-setup-interface').textContent = dict.setupInt;
        document.getElementById('ui-setup-start').textContent = dict.setupStart;
    }

    function startApp() {
        if(!state.target) return alert("Please select a language to learn.");
        localStorage.setItem('poly_target', state.target);
        localStorage.setItem('poly_interface', state.interface);
        
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('app-screen').style.display = 'flex';
        loadApp();
    }

    function openSettings() {
        document.getElementById('app-screen').style.display = 'none';
        document.getElementById('setup-screen').style.display = 'flex';
    }

    /* =========================================================================
       4. MAIN APP ENGINE
    ========================================================================= */
    function loadApp() {
        applyLanguageStyling();
        applyInterfaceTranslations();
        loadStreakAndStats();
        renderContent();
        setupQuiz();
    }

    function applyLanguageStyling() {
        const conf = CONFIG[state.target];
        document.documentElement.style.setProperty('--primary', conf.colors.primary);
        document.documentElement.style.setProperty('--primary-dark', conf.colors.dark);
        document.documentElement.style.setProperty('--accent', conf.colors.accent);
        document.documentElement.style.setProperty('--danger', conf.colors.danger);
        
        document.getElementById('header-symbol').innerHTML = conf.symbol;
        document.getElementById('header-title').textContent = conf.name[state.interface] + " Archive";
    }

    function applyInterfaceTranslations() {
        const dict = UI_I18N[state.interface];
        document.getElementById('ui-nav-settings').textContent = dict.navSettings;
        document.getElementById('ui-header-sub').textContent = dict.headerSub;
        document.getElementById('ui-header-streak').textContent = dict.headerStreak;
        document.getElementById('ui-lbl-special').textContent = dict.lblSpecial;
        document.getElementById('ui-lbl-word').textContent = dict.lblWord;
        document.getElementById('ui-lbl-idiom').textContent = dict.lblIdiom;
        document.getElementById('ui-lbl-proverb').textContent = dict.lblProverb;
        document.getElementById('ui-lbl-challenge').textContent = dict.lblChallenge;
        document.getElementById('ui-quiz-q').textContent = dict.quizQ;
        document.getElementById('next-btn').textContent = dict.nextBtn;
        
        document.getElementById('ui-cal-title').textContent = dict.calTitle;
        document.getElementById('ui-cal-practiced').textContent = dict.calPracticed;
        document.getElementById('ui-cal-close').textContent = dict.calClose;
    }

    function getDayOfYear(d) {
        const start = new Date(d.getFullYear(), 0, 0);
        return Math.floor((d - start) / 86400000);
    }

    function renderContent() {
        const dict = UI_I18N[state.interface];
        const today = new Date();
        if(state.date.toDateString() === today.toDateString()) {
            document.getElementById('current-date-display').textContent = dict.today;
        } else {
            document.getElementById('current-date-display').textContent = state.date.toLocaleDateString(state.interface === 'en' ? 'en-US' : 'tr-TR', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        const db = DB[state.target];
        const doy = getDayOfYear(state.date);
        const y = state.date.getFullYear();
        const m = state.date.getMonth();

        const word = db.words[(doy + y) % db.words.length];
        const idiom = db.idioms[(doy + 15) % db.idioms.length];
        const proverb = db.proverbs[(doy + 30) % db.proverbs.length];
        const special = db.specials[((y * 12) + m) % db.specials.length];

        injectCard('word', word);
        injectCard('idiom', idiom);
        injectCard('proverb', proverb);
        injectCard('special', special);
    }

    function injectCard(id, data) {
        document.getElementById(`${id}-t`).textContent = data.t;
        document.getElementById(`${id}-m`).textContent = data[state.interface];
        document.getElementById(`${id}-p`).textContent = `/${data.p}/`;
    }

    /* =========================================================================
       5. PROGRESS & STATS
    ========================================================================= */
    function getKeys() {
        return {
            streak: `poly_${state.target}_streak`,
            active: `poly_${state.target}_active`,
            stats: `poly_${state.target}_stats`
        };
    }

    function recordActivity() {
        const keys = getKeys();
        const todayStr = new Date().toISOString().split("T")[0];
        let activeDates = JSON.parse(localStorage.getItem(keys.active)) || [];
        
        if (!activeDates.includes(todayStr)) {
            activeDates.push(todayStr);
            localStorage.setItem(keys.active, JSON.stringify(activeDates));
            calculateStreak(activeDates, keys.streak);
        }
    }

    function calculateStreak(dates, streakKey) {
        if(dates.length === 0) return 0;
        dates.sort((a,b) => new Date(b) - new Date(a));
        
        let streak = 0;
        let checkDate = new Date();
        checkDate.setHours(0,0,0,0);
        const todayStr = checkDate.toISOString().split("T")[0];
        
        let yesterday = new Date(checkDate);
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split("T")[0];

        if(!dates.includes(todayStr) && !dates.includes(yesterdayStr)) {
            streak = 0;
        } else {
            let curr = new Date(dates.includes(todayStr) ? checkDate : yesterday);
            while(true) {
                if(dates.includes(curr.toISOString().split("T")[0])) {
                    streak++;
                    curr.setDate(curr.getDate() - 1);
                } else break;
            }
        }
        localStorage.setItem(streakKey, streak);
        document.getElementById('streak-count').textContent = streak;
    }

    function loadStreakAndStats() {
        const keys = getKeys();
        const activeDates = JSON.parse(localStorage.getItem(keys.active)) || [];
        calculateStreak(activeDates, keys.streak);

        const todayStr = new Date().toDateString();
        let stats = JSON.parse(localStorage.getItem(keys.stats));
        if (!stats || stats.date !== todayStr) stats = { date: todayStr, correct: 0, wrong: 0 };
        
        document.getElementById('score-correct').textContent = stats.correct;
        document.getElementById('score-wrong').textContent = stats.wrong;
    }

    function updateStats(isCorrect) {
        const keys = getKeys();
        const todayStr = new Date().toDateString();
        let stats = JSON.parse(localStorage.getItem(keys.stats));
        if (!stats || stats.date !== todayStr) stats = { date: todayStr, correct: 0, wrong: 0 };

        if (isCorrect) stats.correct++; else stats.wrong++;
        localStorage.setItem(keys.stats, JSON.stringify(stats));
        
        document.getElementById('score-correct').textContent = stats.correct;
        document.getElementById('score-wrong').textContent = stats.wrong;
    }

    /* =========================================================================
       6. QUIZ LOGIC
    ========================================================================= */
    function setupQuiz() {
        const container = document.getElementById('quiz-options');
        const feedback = document.getElementById('quiz-feedback');
        const nextBtn = document.getElementById('next-btn');
        const dict = UI_I18N[state.interface];
        
        container.innerHTML = '';
        feedback.textContent = '';
        nextBtn.style.display = 'none';

        const db = DB[state.target].words;
        let correctWord;
        
        do {
            correctWord = db[Math.floor(Math.random() * db.length)];
        } while (db.length > 1 && correctWord.t === state.lastQuizWord);
        
        state.lastQuizWord = correctWord.t;
        
        document.getElementById('quiz-question').textContent = correctWord.t;
        document.getElementById('quiz-pronunciation').textContent = `/${correctWord.p}/`;

        let options = [correctWord];
        let safety = 0;
        while(options.length < 4 && safety < 100) {
            let candidate = db[Math.floor(Math.random() * db.length)];
            if(!options.includes(candidate)) options.push(candidate);
            safety++;
        }
        
        for (let i = options.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [options[i], options[j]] = [options[j], options[i]];
        }

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'quiz-btn';
            btn.textContent = opt[state.interface]; 
            
            btn.onclick = () => {
                document.querySelectorAll('.quiz-btn').forEach(b => b.disabled = true);
                recordActivity();

                if(opt === correctWord) {
                    btn.classList.add('correct');
                    feedback.textContent = dict.correct;
                    feedback.style.color = "var(--correct)";
                    updateStats(true);
                } else {
                    btn.classList.add('wrong');
                    feedback.textContent = `${dict.wrong} ${correctWord[state.interface]}`;
                    feedback.style.color = "var(--wrong)";
                    Array.from(container.children).forEach(c => {
                        if(c.textContent === correctWord[state.interface]) c.classList.add('correct');
                    });
                    updateStats(false);
                }
                nextBtn.style.display = 'inline-block';
            };
            container.appendChild(btn);
        });
    }

    /* =========================================================================
       7. CALENDAR MODAL
    ========================================================================= */
    function openCalendar() {
        state.calDate = new Date(state.date);
        buildCalendar();
        document.getElementById('calendar-modal').style.display = 'flex';
    }
    
    function closeCalendar() { document.getElementById('calendar-modal').style.display = 'none'; }

    function changeCalMonth(offset) {
        state.calDate.setMonth(state.calDate.getMonth() + offset);
        buildCalendar();
    }

    function buildCalendar() {
        const grid = document.getElementById('cal-grid');
        grid.innerHTML = '';
        const dict = UI_I18N[state.interface];
        
        const y = state.calDate.getFullYear();
        const m = state.calDate.getMonth();
        document.getElementById('cal-month-year').textContent = `${dict.months[m]} ${y}`;

        dict.days.forEach(d => {
            const el = document.createElement('div');
            el.className = 'cal-day-name';
            el.textContent = d;
            grid.appendChild(el);
        });

        const firstDay = new Date(y, m, 1).getDay();
        const daysInMonth = new Date(y, m + 1, 0).getDate();
        const activeSet = new Set(JSON.parse(localStorage.getItem(getKeys().active)) || []);
        
        for(let i=0; i<firstDay; i++) {
            const empty = document.createElement('div');
            empty.className = 'cal-cell empty';
            grid.appendChild(empty);
        }

        const currStr = state.date.toISOString().split("T")[0];

        for(let d=1; d<=daysInMonth; d++) {
            const cell = document.createElement('div');
            cell.className = 'cal-cell';
            cell.textContent = d;

            const cellDate = new Date(Date.UTC(y, m, d));
            const dateStr = cellDate.toISOString().split("T")[0];

            if(activeSet.has(dateStr)) cell.classList.add('active-day');
            if(dateStr === currStr) cell.classList.add('selected-day');

            if(cellDate > new Date()) {
                cell.style.opacity = '0.3'; cell.style.cursor = 'not-allowed';
            } else {
                cell.onclick = () => {
                    state.date = new Date(y, m, d);
                    renderContent();
                    closeCalendar();
                };
            }
            grid.appendChild(cell);
        }
    }

    // Init
    window.addEventListener('DOMContentLoaded', initSettings);

</script>
</body>
</html>